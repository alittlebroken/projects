- hosts: local
  tasks:

   - name: 1. Remove existing main virus DB file
     file:
      path: /tmp/main.cvd
      state: absent

   - name: 2. Remove existing daily virus db file
     file:
      path: /tmp/daily.cvd
      state: absent

   - name: 3. Download main virus DB file
     local_action: get_url url=http://database.clamav.net/main.cvd dest=/tmp/main.cvd backup=no

   - name: 4. Download daily virus db file
     local_action: get_url url=http://database.clamav.net/daily.cvd dest=/tmp/daily.cvd backup=no

   - name: 5. Copy the Main virus DB file to the server
     copy:
       src: /tmp/main.cvd
       dest: /usr/lib/clamav/main.cvd
       user: clam
       group: clam
       backup: no
     
   - name: 6. Copy the Daily virus DB file to the server
     copy:
       src: /tmp/daily.cvd
       dest: /usr/lib/clamav/daily.cvd
       user: clam
       group: clam
       backup: no

   - name: 7. Run a virus scan of /tmp to ensure we are using the new definitions
      command: clamscan /tmp
      register: clamscan_results
 
   - name: 8. Check results of clamscan
     debug:
       msg: '{{ clamscan_results }}'
  
